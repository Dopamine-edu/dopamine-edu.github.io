<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dopamine - Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: #f5f7fb;
            --text-color: #2d3748;
            --card-bg: #ffffff;
            --nav-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --card-bg: #2d2d2d;
            --nav-bg: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            --shadow: 0 2px 10px rgba(255,255,255,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
        }

        .navbar {
            background: var(--nav-bg);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .website-name {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .profile-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #ddd;
            margin: 0 auto 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #666;
            overflow: hidden;
        }

        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .avatar-modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .avatar {
            width: 100%;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .avatar:hover {
            border-color: var(--primary-color);
        }

        .profile-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-color);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .form-group input:read-only {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        .password-section {
            grid-column: 1 / -1;
            border-top: 1px solid #ddd;
            padding-top: 2rem;
            margin-top: 1rem;
            display: none;
        }

        .btn {
            background: var(--primary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .profile-container {
                margin: 1rem;
                padding: 1rem;
            }

            .profile-form {
                grid-template-columns: 1fr;
            }

            .avatar-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1 class="website-name">Dopamine</h1>
        <a href="dashboard.html" style="color: white; text-decoration: none;">
            <i class="material-icons">arrow_back</i> Back to Dashboard
        </a>
    </nav>

    <div class="profile-container">
        <div class="profile-header">
            <h2>User Profile</h2>
            <div class="profile-pic" id="profilePic">
                <span>Select Avatar</span>
            </div>
            <p>Click on the profile picture to select an avatar</p>
        </div>

        <!-- Avatar Selection Modal -->
        <div class="avatar-modal" id="avatarModal">
            <div class="avatar-modal-content">
                <h3>Select Your Avatar</h3>
                <div class="avatar-grid">
                    <img src="https://cdn-icons-png.flaticon.com/512/4333/4333609.png" class="avatar" data-avatar="boy">
                    <img src="https://cdn-icons-png.flaticon.com/512/4333/4333607.png" class="avatar" data-avatar="girl">
                    <img src="https://cdn-icons-png.flaticon.com/512/4333/4333608.png" class="avatar" data-avatar="girl-robot">
                    <img src="https://cdn-icons-png.flaticon.com/512/4333/4333605.png" class="avatar" data-avatar="boy-robot">
                    <img src="https://cdn-icons-png.flaticon.com/512/4333/4333606.png" class="avatar" data-avatar="neutral-robot">
                    <img src="https://cdn-icons-png.flaticon.com/512/4333/4333604.png" class="avatar" data-avatar="flower">
                </div>
            </div>
        </div>

        <form class="profile-form" id="profileForm">
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="fullName" required>
            </div>
            
            <div class="form-group">
                <label>College Name</label>
                <input type="text" id="collegeName" required>
            </div>

            <div class="form-group">
                <label>HSC Year</label>
                <input type="number" id="hscYear" min="2024" max="2027" required>
            </div>

            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" id="phone" readonly>
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" readonly>
            </div>

            <div style="grid-column: 1 / -1; text-align: center; margin-top: 1rem;">
                <button type="button" class="btn" onclick="togglePasswordSection()">Change Password</button>
            </div>

            <div class="password-section" id="passwordSection">
                <h3>Change Password</h3>
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" id="currentPassword">
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="newPassword">
                </div>
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPassword">
                </div>
                <button type="button" class="btn" onclick="updatePassword()">Update Password</button>
            </div>

            <button type="submit" class="btn" style="grid-column: 1 / -1">Save Changes</button>
        </form>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXXaWWoFqn6MpH6IWSm6CGaqUJzAmzbzA",
            authDomain: "dopamine-quiz.firebaseapp.com",
            projectId: "dopamine-quiz",
            storageBucket: "dopamine-quiz.firebasestorage.app",
            messagingSenderId: "822531459966",
            appId: "1:822531459966:web:8e7d2385090e997eb1c12f"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let selectedAvatar = null;

        // Modal Handling
        const avatarModal = document.getElementById('avatarModal');
        const profilePic = document.getElementById('profilePic');

        profilePic.addEventListener('click', () => {
            avatarModal.style.display = 'flex';
        });

        avatarModal.addEventListener('click', (e) => {
            if (e.target === avatarModal) {
                avatarModal.style.display = 'none';
            }
        });

        // Avatar Selection
        const avatarGrid = document.querySelector('.avatar-grid');
        avatarGrid.addEventListener('click', (e) => {
            if (e.target.classList.contains('avatar')) {
                selectedAvatar = e.target.src;
                profilePic.innerHTML = `<img src="${selectedAvatar}" alt="Avatar">`;
                avatarModal.style.display = 'none';
            }
        });

        // Load user data
        auth.onAuthStateChanged(async user => {
            if (user) {
                currentUser = user;
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    // Set form values
                    document.getElementById('fullName').value = userData.fullName || '';
                    document.getElementById('collegeName').value = userData.collegeName || '';
                    document.getElementById('hscYear').value = userData.hscYear || '';
                    document.getElementById('phone').value = userData.phone || '';
                    document.getElementById('email').value = user.email;

                    // Set avatar if exists
                    if (userData.avatar) {
                        selectedAvatar = userData.avatar;
                        profilePic.innerHTML = `<img src="${selectedAvatar}" alt="Avatar">`;
                    } else {
                        profilePic.innerHTML = '<span>Select Avatar</span>';
                    }
                }
            } else {
                window.location.href = 'auth.html';
            }
        });

        // Update profile
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const updates = {
                fullName: document.getElementById('fullName').value,
                collegeName: document.getElementById('collegeName').value,
                hscYear: document.getElementById('hscYear').value,
                avatar: selectedAvatar
            };

            await db.collection('users').doc(currentUser.uid).update(updates);
            alert('Profile updated successfully!');
        });

        // Toggle password section
        function togglePasswordSection() {
            const passwordSection = document.getElementById('passwordSection');
            passwordSection.style.display = passwordSection.style.display === 'none' ? 'block' : 'none';
        }

        // Update password
        async function updatePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                alert("Passwords don't match!");
                return;
            }

            try {
                // Reauthenticate user
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email, 
                    currentPassword
                );
                await currentUser.reauthenticateWithCredential(credential);
                
                // Update password
                await currentUser.updatePassword(newPassword);
                alert('Password updated successfully!');
                
                // Clear fields and hide section
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                togglePasswordSection();
            } catch (error) {
                alert('Error updating password: ' + error.message);
            }
        }
    </script>
</body>
</html> 
