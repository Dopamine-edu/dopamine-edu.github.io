<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dopamine Quiz - Question Bank</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f7f9fc;
      margin: 0;
      padding: 0;
    }
    .navbar {
      background: #667eea;
      padding: 15px 20px;
    }
    .navbar-brand { color: #fff; font-weight: bold; }
    .container { padding: 20px; }
    .subject-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    .subject-btn {
      background: #667eea;
      color: #fff;
      border: none;
      padding: 10px;
      border-radius: 5px;
      transition: background 0.3s;
    }
    .subject-btn:hover { background: #556cd6; }
    .question-card {
      background: #fff;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 10px;
    }
    .question-card ul { margin-left: 20px; }
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 20px;
      color: #667eea;
    }
    .error-message {
      display: none;
      color: #dc3545;
      text-align: center;
      padding: 10px;
    }
    @media (max-width: 576px) {
      .subject-grid { grid-template-columns: 1fr; }
      .navbar-brand { font-size: 1.2rem; }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Question Bank</a>
      <button id="backBtn" class="btn btn-outline-light">‚Üê Back to Admin</button>
    </div>
  </nav>

  <div class="container">
    <input type="text" id="searchBar" class="form-control mb-3" placeholder="Search questions...">
    <div id="subjectList" class="subject-grid">
      <button class="subject-btn" data-subject="Biology 1st">Biology 1st</button>
      <button class="subject-btn" data-subject="Biology 2nd">Biology 2nd</button>
      <button class="subject-btn" data-subject="Physics 1st">Physics 1st</button>
      <button class="subject-btn" data-subject="Physics 2nd">Physics 2nd</button>
      <button class="subject-btn" data-subject="Chemistry 1st">Chemistry 1st</button>
      <button class="subject-btn" data-subject="Chemistry 2nd">Chemistry 2nd</button>
      <button class="subject-btn" data-subject="Bangla">Bangla</button>
      <button class="subject-btn" data-subject="English">English</button>
    </div>

    <div id="questionDisplay">
      <div id="loading" class="loading-spinner">Loading...</div>
      <div id="error" class="error-message"></div>
      <div id="questionsContainer"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBXXaWWoFqn6MpH6IWSm6CGaqUJzAmzbzA",
      authDomain: "dopamine-quiz.firebaseapp.com",
      projectId: "dopamine-quiz",
      storageBucket: "dopamine-quiz.firebasestorage.app",
      messagingSenderId: "822531459966",
      appId: "1:822531459966:web:8e7d2385090e997eb1c12f"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    auth.onAuthStateChanged((user) => {
      if (!user) {
        window.location.href = "auth.html";
      }
    });

    document.getElementById("backBtn").addEventListener("click", () => {
      window.location.href = "admin.html";
    });

    const subjectButtons = document.querySelectorAll(".subject-btn");
    const searchBar = document.getElementById("searchBar");
    let allQuestions = [];

    subjectButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const subject = btn.getAttribute("data-subject");
        displayQuestions(subject);
      });
    });

    searchBar.addEventListener("input", () => {
      const searchTerm = searchBar.value.toLowerCase();
      filterQuestions(searchTerm);
    });

    function displayQuestions(subject) {
      const displayDiv = document.getElementById("questionsContainer");
      const loadingDiv = document.getElementById("loading");
      const errorDiv = document.getElementById("error");
      displayDiv.innerHTML = "";
      loadingDiv.style.display = "block";
      errorDiv.style.display = "none";

      db.collection("questions")
        .where("subject", "==", subject)
        .orderBy("timestamp", "desc")
        .get()
        .then((querySnapshot) => {
          loadingDiv.style.display = "none";
          if (querySnapshot.empty) {
            displayDiv.innerHTML = "<p>No questions found for this subject.</p>";
          } else {
            allQuestions = [];
            querySnapshot.forEach((doc) => {
              const data = doc.data();
              allQuestions.push({ id: doc.id, ...data });
              const qItem = document.createElement("div");
              qItem.classList.add("question-card");
              qItem.innerHTML = `
                <h3>${data.question}</h3>
                <p><strong>Options:</strong></p>
                <ul>
                  ${data.options.map((opt) => `<li>${opt}</li>`).join("")}
                </ul>
                ${data.explanation ? `<p><strong>Explanation:</strong> ${data.explanation}</p>` : ""}
              `;
              displayDiv.appendChild(qItem);
            });
            Toastify({
              text: `Loaded questions for ${subject}`,
              duration: 3000,
              style: { background: "#667eea" }
            }).showToast();
          }
        })
        .catch((error) => {
          loadingDiv.style.display = "none";
          errorDiv.style.display = "block";
          errorDiv.innerText = "Error retrieving questions: " + error.message;
          Toastify({
            text: "Error loading questions",
            duration: 3000,
            style: { background: "#dc3545" }
          }).showToast();
        });
    }

    function filterQuestions(searchTerm) {
      const displayDiv = document.getElementById("questionsContainer");
      displayDiv.innerHTML = "";
      const filtered = allQuestions.filter((q) =>
        q.question.toLowerCase().includes(searchTerm)
      );
      if (filtered.length === 0) {
        displayDiv.innerHTML = "<p>No matching questions found.</p>";
      } else {
        filtered.forEach((data) => {
          const qItem = document.createElement("div");
          qItem.classList.add("question-card");
          qItem.innerHTML = `
            <h3>${data.question}</h3>
            <p><strong>Options:</strong></p>
            <ul>
              ${data.options.map((opt) => `<li>${opt}</li>`).join("")}
            </ul>
            ${data.explanation ? `<p><strong>Explanation:</strong> ${data.explanation}</p>` : ""}
          `;
          displayDiv.appendChild(qItem);
        });
      }
    }
  </script>
</body>
</html> 
